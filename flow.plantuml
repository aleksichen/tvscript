@startuml
start

:初始化 KotoLexer;
:调用 KotoLexer::new(source);

if (是否有更多字符?) then (是)
  :调用 TokenLexer::get_next_token;
  if (当前字符是空白字符?) then (是)
    :调用 consume_and_count;
    :生成 Whitespace 标记;
  else if (当前字符是换行符?) then (是)
    :调用 consume_newline;
    :生成 NewLine 标记;
  else if (当前字符是注释符号?) then (是)
    :调用 consume_comment;
    :生成 CommentSingle 或 CommentMulti 标记;
  else if (当前字符是字符串引号?) then (是)
    :调用 consume_string_literal 或 consume_raw_string_contents;
    :生成 StringStart、StringLiteral 或 StringEnd 标记;
  else if (当前字符是数字?) then (是)
    :调用 consume_number;
    :生成 Number 标记;
  else if (当前字符是标识符或关键字?) then (是)
    :调用 consume_id_or_keyword;
    :生成 Id 或关键字标记;
  else if (当前字符是符号或操作符?) then (是)
    :调用 consume_symbol;
    :生成符号或操作符标记;
  else (其他)
    :生成 Error 标记;
  endif
else (否)
  :返回 None;
endif

:返回 LexedToken;

stop

@enduml